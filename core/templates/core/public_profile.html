{% extends 'core/base.html' %}
{% load humanize %}

{% block seo_title %}Bibliotype â€“ {{ heading_name }} Reading DNA{% endblock %}

{% block seo_description %}{% if dna %}View {{ title }} and literary personality. Discover their favorite genres, reading statistics, and book preferences.{% else %}{{ title }} profile.{% endif %}{% endblock %}

{% block og_title %}{{ title }}{% endblock %}

{% block og_description %}{% if dna %}Discover {{ title }} and their unique reading DNA, literary personality, favorite genres, and reading insights.{% else %}{{ title }} profile.{% endif %}{% endblock %}

{% block twitter_title %}{{ title }}{% endblock %}

{% block twitter_description %}{% if dna %}View {{ title }} and discover their literary personality.{% else %}{{ title }} profile.{% endif %}{% endblock %}

{% block structured_data %}
{% if dna %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ProfilePage",
    "name": "{{ title }}",
    "description": "{{ title }} personalized reading DNA and literary personality profile",
    "url": "{{ request.scheme }}://{{ request.get_host }}{{ request.path }}",
    "mainEntity": {
        "@type": "Person",
        "name": "{{ profile_user.first_name|default:profile_user.username }}",
        "url": "{{ request.scheme }}://{{ request.get_host }}{{ request.path }}"
    }
}
</script>
{% endif %}
{% endblock %}

{% block content %}
    <div class="mx-auto max-w-4xl space-y-8 p-4">
        {# Check if DNA data exists for this user #}
        {% if dna %}
            {# This script tag is still needed for the charts to work #}
            {{ dna|json_script:"dna-data" }}
            <!-- The main header, personalized with the profile owner's name -->
            <h1 class="mb-8 flex flex-col items-center justify-center gap-x-4 text-center text-4xl font-bold tracking-widest uppercase sm:text-5xl md:flex-row">
                <span>{{ heading_name }}</span>
                <span class="whitespace-nowrap">Reading DNA</span>
            </h1>
            
            {% include 'core/partials/dna/vibe_display.html' %}

            {% with owner_pos=profile_user.first_name|default:profile_user.username|add:"'s" %}
                {% include 'core/partials/dna/reader_type_card.html' %}
            {% endwith %}

            {% include 'core/partials/dna/top_traits_list.html' %}
            
            {% include 'core/partials/dna/key_stats_row.html' %}

            {% include 'core/partials/dna/comparative_analytics_card.html' with pronoun_pos="Their" pronoun_sub="They" is_public=True %}
            
            <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
                {% if dna.most_niche_book %}
                    {% with niche_caption="Read by only "|add:dna.most_niche_book.read_count|stringformat:"s"|add:" Bibliotype user(s)!" pronoun_pos="Their" %}
                        {% include 'core/partials/dna/niche_read_card.html' %}
                    {% endwith %}
                {% else %}
                    {% include 'core/partials/dna/niche_read_card.html' with pronoun_pos="Their" %}
                {% endif %}
                
                {% include 'core/partials/dna/mainstream_gauge_card.html' with pronoun_pos="Their" %}
            </div>
            
            {% include 'core/partials/dna/books_per_year_card.html' %}
            
            {% include 'core/partials/dna/top_genres_authors_row.html' with use_rainbow=True %}
            
            {% include 'core/partials/dna/controversial_ratings_card.html' with controversial_title='Most "Controversial" Ratings ðŸ¤¯' pronoun_pos="their" %}
            
            {% if recommendations %}
                {% with name=profile_user.first_name|default:profile_user.username %}
                    {% include 'core/partials/dna/recommendations_grid.html' with rec_title="Recommended for "|add:name is_public_view=True %}
                {% endwith %}
            {% endif %}
            
            {% include 'core/partials/dna/charts_scripts.html' %}
        {% else %}
            <div class="border-brand-text shadow-neo border-2 bg-white p-8 text-center">
                <h2 class="text-2xl font-bold tracking-tight text-gray-900 uppercase">No Bibliotype Found</h2>
                <p class="mt-3 text-lg text-gray-600">This user hasn't generated their public Bibliotype yet.</p>
            </div>
        {% endif %}
    </div>
{% endblock %}
